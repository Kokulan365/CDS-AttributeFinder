using System;
using System.ComponentModel.Composition;
using System.IO;
using System.Linq;
using System.Collections.Generic;
using System.Reflection;
using XrmToolBox.Extensibility;
using XrmToolBox.Extensibility.Interfaces;

namespace AttributeFinder
{
	// Do not forget to update version number and author (company attribute) in AssemblyInfo.cs class
	// To generate Base64 string for Images below, you can use https://www.base64-image.de/
	[Export(typeof(IXrmToolBoxPlugin)),
		ExportMetadata("Name", "Attribute Finder"),
		ExportMetadata("Description", "This plugin allows you to search attributes across all system and custom entities"),
		// Please specify the base64 content of a 32x32 pixels image
		ExportMetadata("SmallImageBase64", "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"),
		// Please specify the base64 content of a 80x80 pixels image
		ExportMetadata("BigImageBase64", "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"),
		ExportMetadata("Author", "Kokulan"),
		ExportMetadata("BackgroundColor", "#571360"),
		ExportMetadata("PrimaryFontColor", "White"),
		ExportMetadata("SecondaryFontColor", "Gray")]
	public class MyPlugin : PluginBase
	{
		public override IXrmToolBoxPluginControl GetControl()
		{
			return new MyPluginControl();
		}

		/// <summary>
		/// Constructor 
		/// </summary>
		public MyPlugin()
		{
			// If you have external assemblies that you need to load, uncomment the following to 
			// hook into the event that will fire when an Assembly fails to resolve
			// AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(AssemblyResolveEventHandler);
		}

		/// <summary>
		/// Event fired by CLR when an assembly reference fails to load
		/// Assumes that related assemblies will be loaded from a subfolder named the same as the Plugin
		/// For example, a folder named Sample.XrmToolBox.MyPlugin 
		/// </summary>
		/// <param name="sender"></param>
		/// <param name="args"></param>
		/// <returns></returns>
		private Assembly AssemblyResolveEventHandler(object sender, ResolveEventArgs args)
		{
			Assembly loadAssembly = null;
			Assembly currAssembly = Assembly.GetExecutingAssembly();

			// base name of the assembly that failed to resolve
			var argName = args.Name.Substring(0, args.Name.IndexOf(","));

			// check to see if the failing assembly is one that we reference.
			List<AssemblyName> refAssemblies = currAssembly.GetReferencedAssemblies().ToList();
			var refAssembly = refAssemblies.Where(a => a.Name == argName).FirstOrDefault();

			// if the current unresolved assembly is referenced by our plugin, attempt to load
			if (refAssembly != null)
			{
				// load from the path to this plugin assembly, not host executable
				string dir = Path.GetDirectoryName(currAssembly.Location).ToLower();
				string folder = Path.GetFileNameWithoutExtension(currAssembly.Location);
				dir = Path.Combine(dir, folder);

				var assmbPath = Path.Combine(dir, $"{argName}.dll");

				if (File.Exists(assmbPath))
				{
					loadAssembly = Assembly.LoadFrom(assmbPath);
				}
				else
				{
					throw new FileNotFoundException($"Unable to locate dependency: {assmbPath}");
				}
			}

			return loadAssembly;
		}
	}
}